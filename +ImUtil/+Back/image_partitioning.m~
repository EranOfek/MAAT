function [Sub]=image_partitioning(Image,BlockSize,varargin)
% Partition a 2D image into sub images.
% Package: ImUtil
% Description: 
% Input  : - 
%          * Arbitrary number of pairs of arguments: ...,keyword,value,...
%            where keyword are one of the followings:
% Output : - 
% License: GNU general public license version 3
%     By : Eran O. Ofek                    Sep 2019
%    URL : http://weizmann.ac.il/home/eofek/matlab/
% Example: 
% Reliable: 
%--------------------------------------------------------------------------



DefV.Buffer               = 10; 
InPar = InArg.populate_keyval(DefV,varargin,mfilename);


if numel(BlockSize)==1
    BlockSize = [BlockSize, BlockSize];
end

ImageSize = fliplr(size(Image));  % [X,Y]

[ListEdge,ListCenter] = ImUtil.Im.image_blocks(ImageSize,BlockSize,InPar.Buffer,'simple');
Xmin = ListEdge(:,1);
Xmax = ListEdge(:,2);
Ymin = ListEdge(:,3);
Ymax = ListEdge(:,4);

Nblock = size(ListEdges,1);

Util
for Iblock=1:1:Nblock
    Sub(Iblock).Image = Image(Ymin(Iblock):Ymax(Iblock),Xmin(Iblock):Xmax(Iblock));
    